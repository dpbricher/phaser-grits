// Generated by CoffeeScript 1.8.0
require(["lib/phaser.min"], function() {
  var PLAYER_SPEED, PROJECTILE_SPEED, RELOAD_TIME, cursors, game, groupProj, lastFireTime, moveKeys, player, tileLayer, tileMap, wallLayer;
  PLAYER_SPEED = 500;
  PROJECTILE_SPEED = 1000;
  RELOAD_TIME = 0.2;
  tileMap = null;
  tileLayer = null;
  wallLayer = null;
  groupProj = null;
  player = null;
  lastFireTime = 0;
  moveKeys = null;
  cursors = null;
  return game = new Phaser.Game(800, 600, Phaser.AUTO, "content-main", {
    preload: function() {
      game.load.tilemap("map", "data/map1.json", null, Phaser.Tilemap.TILED_JSON);
      game.load.image("map_tiles", "images/grits_master.png");
      return game.load.atlas("anims", "images/grits_effects.png", "data/grits_effects.json", null, Phaser.Loader.TEXTURE_ATLAS_JSON_HASH);
    },
    create: function() {
      var keyboard;
      game.physics.startSystem(Phaser.Physics.ARCADE);
      tileMap = game.add.tilemap("map");
      tileMap.addTilesetImage("grits_master", "map_tiles");
      tileLayer = tileMap.createLayer("floor");
      tileLayer.resizeWorld();
      tileMap.createLayer("floor_blend");
      wallLayer = tileMap.createLayer("walls");
      tileMap.createLayer("lights");
      tileMap.createLayer("decor_02");
      tileMap.setCollisionByExclusion([], true, "walls");
      groupProj = game.add.group();
      player = game.add.sprite(1284, 1284, "anims");
      player.anchor.set(0.5, 0.5);
      player.animations.add("walk_anim", Phaser.Animation.generateFrameNames("walk_left_", 0, 29, ".png", 4), 25, true);
      player.animations.play("walk_anim").stop();
      game.physics.arcade.enable(player);
      player.body.collideWorldBounds = true;
      player.body.setSize(player.body.width / 2, player.body.height / 2);
      lastFireTime = game.time.totalElapsedSeconds();
      keyboard = game.input.keyboard;
      cursors = keyboard.createCursorKeys();
      moveKeys = {
        up: keyboard.addKey(Phaser.Keyboard.W),
        down: keyboard.addKey(Phaser.Keyboard.S),
        left: keyboard.addKey(Phaser.Keyboard.A),
        right: keyboard.addKey(Phaser.Keyboard.D)
      };
      return game.camera.follow(player);
    },
    update: function() {
      var bullet, velocity;
      velocity = player.body.velocity.set(0, 0);
      if (moveKeys.right.isDown) {
        velocity.x += 1;
      }
      if (moveKeys.left.isDown) {
        velocity.x -= 1;
      }
      if (moveKeys.up.isDown) {
        velocity.y -= 1;
      }
      if (moveKeys.down.isDown) {
        velocity.y += 1;
      }
      velocity.normalize().multiply(PLAYER_SPEED, PLAYER_SPEED);
      if (!velocity.isZero()) {
        player.rotation = velocity.angle(new Phaser.Point());
        player.animations.next(1);
      }
      velocity = new Phaser.Point();
      if (cursors.right.isDown) {
        velocity.x += 1;
      }
      if (cursors.left.isDown) {
        velocity.x -= 1;
      }
      if (cursors.up.isDown) {
        velocity.y -= 1;
      }
      if (cursors.down.isDown) {
        velocity.y += 1;
      }
      if (!velocity.isZero() && game.time.totalElapsedSeconds() - lastFireTime >= RELOAD_TIME) {
        bullet = groupProj.create(player.body.position.x + player.body.width / 2, player.body.position.y + player.body.height / 2, "anims");
        bullet.anchor.set(0.5, 0.5);
        bullet.animations.add("bullet", Phaser.Animation.generateFrameNames("machinegun_projectile_", 0, 7, ".png", 4), 25, true);
        bullet.animations.play("bullet");
        game.physics.arcade.enable(bullet);
        velocity.normalize();
        bullet.rotation = velocity.angle(new Phaser.Point());
        bullet.body.velocity = velocity.multiply(PROJECTILE_SPEED, PROJECTILE_SPEED);
        lastFireTime = game.time.totalElapsedSeconds();
      }
      return game.physics.arcade.collide(player, wallLayer);
    },
    render: function() {
      return game.debug.body(player);
    }
  });
});
